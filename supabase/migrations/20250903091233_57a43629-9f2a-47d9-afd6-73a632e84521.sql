-- Fix profiles table constraint for ON CONFLICT
ALTER TABLE public.profiles ADD CONSTRAINT profiles_user_id_unique UNIQUE (user_id);

-- Delete test users and their related data
DELETE FROM public.profiles WHERE user_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222');
DELETE FROM public.tips WHERE user_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222');
DELETE FROM public.friendships WHERE requester_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222') OR addressee_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222');
DELETE FROM public.conversations WHERE participant1_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222') OR participant2_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222');
DELETE FROM public.conversation_messages WHERE user_id IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222');

-- Add metadata columns to tips table for storing fetched product info
ALTER TABLE public.tips ADD COLUMN IF NOT EXISTS scraped_title TEXT;
ALTER TABLE public.tips ADD COLUMN IF NOT EXISTS scraped_image_url TEXT;
ALTER TABLE public.tips ADD COLUMN IF NOT EXISTS scraped_description TEXT;